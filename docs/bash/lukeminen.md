---
priority: 110
---

# Lukeminen

## Mist√§ on kyse?

Aloitetaan jo olemassa olevien skriptien lukemisesta. On kovin tyypillist√§, ett√§ ohjelmiston asennuksen tai k√§ytt√∂√∂noton yhteydess√§ sinua neuvotaan ajamaan online-hostattu skripti. Tyypillisesti vaihe n√§ytt√§√§ t√§lt√§:

```bash title="Bash"
curl -sSLf https://example.com/install.sh | bash
```

!!! tip 

    Esimerkiss√§ olevan komennon `curl` parametrit ovat:

    * `-s` tai `--silent`: √Ñl√§ n√§yt√§ lataustietoja.
    * `-S` tai `--show-error`: N√§yt√§ virheilmoitukset.
    * `-L` tai `--location`: Seuraa mahdollisia uudelleenohjauksia.
    * `-f` tai `--fail`: Lopeta, jos lataus ep√§onnistuu.

Koska netti on pullollaan skriptej√§, joita sinua neuvotaan ajamaan eri tutoriaaleissa ja asennusohjeissa, on hyv√§ osata lukea niit√§. Jos osaat lukea muiden skriptej√§, kynnys kirjoittaa omia madaltuu. Samalla huomaat, ett√§ jopa ammattilaisten laatimat skriptit koostuvat kohtalaisen pienest√§ m√§√§r√§st√§ peruspalikoita.

## Esimerkkej√§

### üê≥ Docker

Dockerin asennusvaiheeseen kuuluu kasa komentoja, jotka voi automatisoida skriptill√§. Lue lis√§√§ [Install Docker Engine on Ubuntu: Install using the convenience script](https://docs.docker.com/engine/install/ubuntu/#install-using-the-convenience-script)

Itse skripti l√∂ytyy osoitteesta: [get.docker.com/](https://get.docker.com/)

### üç∫ Homebrew

Homebrew-paketinhallinta on macOS-k√§ytt√§jille tuttu *"apt:n korvike"*, mutta sen voi asentaa my√∂s Linuxille. Ohjeistus on heti etusivulla: [brew.sh](https://brew.sh/).

Itse skripti l√∂ytyy osoitteesta: [raw.githubusercontent.com/Homebrew/install/HEAD/install.sh](https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)

### üêç Uv

Uv on Pythonin verrattain tuore paketinhallintaty√∂kalu, jota k√§ytet√§√§n my√∂s t√§ll√§ kurssilla. Sen asennus hoidetaan niin Linux/macOS kuin Windows ymp√§rist√∂ss√§ skriptin avulla. Tutustu [Installing uv](https://docs.astral.sh/uv/getting-started/installation/)-ohjeeseen.

Itse skripti l√∂ytyy osoitteesta: [astral.sh/uv/install.sh](https://astral.sh/uv/install.sh)

### ü¶Ä Rust

Rust on tuoreehko, melko paljon p√∂hin√§√§ aiheuttava ohjelmointikieli. Sill√§ koodatut sovellukset, kuten yll√§ mainittu uv, muistavat yleens√§ kertoa olevansa *blazingly fast*. Kieli soveltuu sulautettuihin j√§rjestelmiin ja suorituskyky√§ vaativiin sovelluksiin, aivan kuten C/C++, joten emme suinkaan k√§yt√§ sit√§ t√§ll√§ kurssilla - mutta Rustin asennus onnistuu skriptill√§, ja t√§h√§n me tutustumme. Tutustu [Install Rust](https://www.rust-lang.org/tools/install)-ohjeeseen.

Itse skripti l√∂ytyy osoitteesta: [sh.rustup.rs](https://sh.rustup.rs)

### üì¶ Volta

Volta on Node.js:n versioiden hallintaan tarkoitettu ty√∂kalu, joka on jossain m√§√§rin vastaava kuin yll√§ mainittu `uv`, mutta Pythonin sijasta kielen√§ on JavaScript/Node.js. Tutustu [Getting Started](https://docs.volta.sh/guide/getting-started)-ohjeeseen.

Itse skripti l√∂ytyy osoitteesta: [get.volta.sh](https://get.volta.sh)

### Kokoelmat

Lis√§ksi voit tutustua my√∂s communityn koostamiin kokoelmiin, joista l√∂ytyy yleens√§ hieman lyhyempi√§ snippettej√§. Hyvi√§ ovat ainakin:

* [gh:djeada/Bash-Scripts](https://github.com/djeada/Bash-Scripts)
* [gh:awesome-lists/awesome-bash](https://github.com/awesome-lists/awesome-bash)

## Esimerkki: Docker-skriptin parsiminen

T√§m√§ toimii apuna my√∂hemp√§√§ teht√§v√§√§ varten. Alla on [get.docker.com](https://get.docker.com/)-skripti avattuna siten, ett√§ siit√§ l√∂ytyv√§t uniikit komennot tai syntaksin muodot on listattu auki.

![](../images/vscode-to-inspect-docker.png)

**Kuva 1:** *Skripti ja muistiinpanot auki VS Codessa. Kun parsit skripti√§, t√§m√§ on yksi potentiaalinen ty√∂tapa. Tuhoa vasemmalta rivej√§ sit√§ mukaan kun olet k√§ynyt, ja kirjoita uusia l√∂yd√∂ksi√§ oikealla olevaan memo-tiedostoon. Lopuksi muotoile muistiinpanot julkaisukuntoon.*

### Bash-yleiset

| Syntaksi          | Mit√§ se tekee                                                    |
| ----------------- | ---------------------------------------------------------------- |
| `#!/bin/sh`       | M√§√§ritt√§√§, ett√§ skripti ajetaan ko. polun ohjelmalla. [^shebang] |
| `set -e`          | Lopeta skripti v√§litt√∂m√§sti, jos komento ep√§onnistuu. [^set-e]   |
| `# Lorem ipsum`   | Kommentti. Ei vaikuta skriptin suoritukseen.                     |
| `set +x` tai `-x` | Laita debuggaustila p√§√§lle tai pois p√§√§lt√§. [^debug]             |
| `exit 1` tai `0`  | Lopeta skripti ja palauta virhekoodi. [^exit]                    |

[^shebang]: Wikipedia. Shebang (Unix). https://en.wikipedia.org/wiki/Shebang_(Unix)
[^set-e]: GNU. The Set Builtin. https://www.gnu.org/software/bash/manual/html_node/The-Set-Builtin.html
[^debug]: The Linux Documentation Project. Bash Guide for Beginners: 2.3. Debugging Bash scripts. https://tldp.org/LDP/Bash-Beginners-Guide/html/sect_02_03.html
[^exit]: GNU. Bourne Shell Builtins. https://www.gnu.org/software/bash/manual/html_node/Bourne-Shell-Builtins.html#index-exit

### Muuttujat

| Syntaksi               | Mit√§ se tekee                                                                            |
| ---------------------- | ---------------------------------------------------------------------------------------- |
| `FOO=bar`              | M√§√§ritt√§√§ muuttujan `FOO` arvolla `bar`.                                                 |
| `${VERSION#v}`         | Poistaa muuttujan `VERSION` arvosta etuliitteen `v`. [^param-exp-prefix]                 |
| `DRY_RUN=${DRY_RUN:-}` | Varmistaa, ett√§ muuttuja `DRY_RUN` ei ole unset.                                         |
| `$(uname -r)`          | Asettaa muuttujaan komennon tulosteen. Esim. `TODAY=$(date +%Y-%m-%d)`. [^command-subst] |

[^param-exp-prefix]: GNU. Shell Parameter Expansion. https://www.gnu.org/software/bash/manual/html_node/Shell-Parameter-Expansion.html
[^command-subst]: GNU. Command Substitution. https://www.gnu.org/software/bash/manual/html_node/Command-Substitution.html

### Ehtorakenteet

| Syntaksi                       | Mit√§ se tekee                                                    |
| ------------------------------ | ---------------------------------------------------------------- |
| `if [ ... ]; then ... fi`      | Suorittaa lohkon, jos ehto on tosi. [^if]                        |
| `case "$muuttuja" in ... esac` | Valitsee yhden monista vaihtoehdoista. Pitk√§n if elsen korvaaja. |
| `[ ehto ]`                     | POSIX-yhteensopiva ehto.                                         |
| `[ -z "$CHANNEL" ]`            | Tarkistaa, ett√§ muuttuja on tyhj√§. [^conditional]                |
| `[ -n "$cli_pkg_version" ]`    | Tarkistaa, ett√§ muuttuja ei ole tyhj√§. [^conditional]            |

[^if]: GNU. Conditional Constructs. https://www.gnu.org/software/bash/manual/html_node/Conditional-Constructs.html
[^conditional]: GNU. Bash Conditional Expressions. https://www.gnu.org/software/bash/manual/html_node/Bash-Conditional-Expressions.html

### Silmukat

| Syntaksi                     | Mit√§ se tekee                                             |
| ---------------------------- | --------------------------------------------------------- |
| `while [ ... ]; do ... done` | Suorittaa lohkon niin kauan kuin ehto on tosi. [^looping] |

[^looping]: GNU. Looping Constructs. https://www.gnu.org/software/bash/manual/html_node/Looping-Constructs.html


### Funktiot

| Syntaksi                   | Mit√§ se tekee                                |
| -------------------------- | -------------------------------------------- |
| `command_exists() { ... }` | M√§√§ritt√§√§ funktion nimelt√§√§n command exists. |
| `command_exists`           | Ajaa funktion command_exists.                |

### Tulostus

| Syntaksi                                          | Mit√§ se tekee                                           |
| ------------------------------------------------- | ------------------------------------------------------- |
| `echo "Illegal option $1"`                        | Tulostaa merkkijonon terminaaliin. [^echo]              |
| `printf "\033[91;1mDEPRECATION WARNING\033[0m\n"` | Tulostaa muotoillun merkkijonon terminaaliin. [^printf] |


[^echo]: GNU. Bash Builtins. https://www.gnu.org/software/bash/manual/html_node/Bash-Builtins.html#index-echo
[^printf]: GNU. Bash Builtins. https://www.gnu.org/software/bash/manual/html_node/Bash-Builtins.html#index-printf

### Vaikeammat tapaukset

#### cat (heredoc)

* Milt√§ n√§ytt√§√§:
 
    ```bash
    cat >&2 <<-'EOF'
        Warning: the "docker" command...

        ... monta rivi√§ teksti√§ ...

        You may press Ctrl+C now to abort this script.
    EOF
    ```

* Mit√§ se tekee: Tulostaa monirivisen tekstin terminaaliin. `>&2` ohjaa tulosteen virhevirtaan.

#### Shift

* Milt√§ n√§ytt√§√§: `shift`
* Mit√§ se tekee: Siirt√§√§ positionaalisia argumentteja vasemmalle. Esim. jos skripti saa argumentteja, niin ensimm√§inen argumentti poistetaan ja muut siirtyv√§t vasemmalle. Katso alta *Positionaaliset argumentit*, jossa t√§lle annetaan hieman kontekstia.

#### Ternary operaattori

* Milt√§ n√§ytt√§√§: `$(( ehto ? jos_totta : jos_ep√§totta ))`
* Mit√§ se tekee: Palauttaa joko `jos_totta` tai `jos_ep√§totta` riippuen ehdosta. Katso alta *Positionaaliset argumentit*, jossa t√§lle annetaan hieman kontekstia.

#### Positionaaliset argumentit

* Milt√§ n√§ytt√§√§: `$#`
* Mit√§ se tekee: Palauttaa positionaalisten argumenttien m√§√§r√§n.
* Miksi se on k√§yt√∂ss√§: Se parsii skriptille annetut argumentit muuttujiin.

T√§m√§ on ==muita skriptin tekij√∂it√§ haastavampi kokonaisuus==, ja on ok, jos se ei heti tunnu ilmiselv√§lt√§. Docker-asennusskriptiss√§ sit√§ k√§ytet√§√§n parsimaan skriptille annetut argumentit muuttujiin, n√§in:

```bash
while [ $# -gt 0 ]; do
    case "$1" in
        --foo)
            FOO="$2"
            shift
            ;;
        --bar)
            BAR="$2"
            shift
            ;;
        --toggle)
            TOGGLE=1
            ;;
        *)
            echo "Illegal option $1"
            exit 1
            ;;
    esac
    shift $(( $# > 0 ? 1 : 0 ))  # Siirr√§ argumentteja vasemmalle, jos niit√§ on j√§ljell√§
done
```

Kyseisen skriptin voisi ajaa: 
```bash title="Bash"
# N√§in
./skripti.sh --foo arvo1 --bar arvo2 --toggle

# Tai eri j√§rjestyksess√§
./skripti --toggle -bar arvo2 --foo arvo1
```

J√§rjestyksest√§ riippumatta lopputulema on, ett√§ `FOO=arvo1`, `BAR=arvo2` ja `TOGGLE=1`.
* Lis√§tietoa: [Positional Parameters](https://www.gnu.org/software/bash/manual/html_node/Positional-Parameters.html)


## Teht√§v√§t

!!! question "Teht√§v√§: Parsi Bash-skripti"

    Ota mallia yll√§ olevasta Docker-skriptin parsimisesta, ja parsi jokin muu:

    * uv
    * Homebrew
    * Rust
    * ...tai jokin l√∂yt√§m√§si, joka edustaa samaa vaikeustasoa.

    Kirjoita yl√∂s l√∂yt√§m√§si syntaksin palaset, jotka ovat uniikkeja. Voit tehd√§ t√§m√§n esimerkiksi seuraavasti:

    1. Lataa tiedosto: `curl -sSLf https://example.com/install.sh > to-inspect.sh`
    2. Avaa Visual Studio Codessa: `code to-inspect.sh`
    3. Aloita tiedoston ylh√§√§lt√§ ja prosessoi se rivi rivilt√§.
   
    Tee seuraavat toimenpiteet **jokaiselle koodiriville**:

    * ‚úÖ Jos koodirivi sis√§lt√§√§ entuudestaan vierasta syntaksia: dokumentoi se. üìÑ
    * üîÅ Jos koodirivin syntaksi on jo esiintynyt aiemmin scriptiss√§: unohda rivi. ü´≥
    * T√§m√§n j√§lkeen poista kyseinen koodirivi tiedostosta.
 
    Kun olet k√§ynyt koko tiedoston l√§pi, sinulla pit√§isi olla dokumentoitu lista uniikeista syntaksin palasista. Muotoile t√§m√§ itsellesi sopivaksi listaksi. Lista voi olla kuten yll√§ oleva, tai jos keksit paremman tavan muotoilla samat asiat, k√§yt√§ sit√§.

    !!! tip "Ajans√§√§st√∂√§ teko√§lyll√§! ü§ñ"

        T√§ss√§ teht√§v√§ss√§ on suorastaan suositeltua k√§ytt√§√§ teko√§ly√§ apuna selitt√§m√§√§n, mit√§ kyseiset Bash-kielen entuudestaan tuntemattomat koodirimpsut tekev√§t. Jos muotoilet kysymyksen oikein, kielimalli tarjoaa sinulle jopa linkit Bashin dokumentaatioon. 
        
        HUOM! ==Tarkista vastaus, linkki ja linkin sis√§lt√∂!== Vastuu vastauksen oikeellisuudesta on sinulla!

## L√§hteet